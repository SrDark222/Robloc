<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Roblox Avatar 3D Clean - DK Edition</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
  * {
    margin:0; padding:0; box-sizing: border-box; font-family: 'Inter', sans-serif;
  }
  body, html {
    height: 100%;
    background-color: #000000;
    color: #ccc;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    user-select:none;
  }
  h1 {
    margin: 20px 0;
    font-weight: 600;
    color: #eee;
  }
  #inputNick {
    width: 280px;
    padding: 12px 16px;
    border-radius: 12px;
    border: none;
    background: rgba(255,255,255,0.05);
    color: #eee;
    font-size: 16px;
    outline: none;
    box-shadow: 0 0 8px rgba(255,255,255,0.1);
    transition: box-shadow 0.3s ease;
  }
  #inputNick:focus {
    box-shadow: 0 0 12px #1e90ffaa;
  }
  #btnLoad {
    margin-left: 12px;
    padding: 12px 22px;
    border-radius: 12px;
    background: #1e90ff;
    border: none;
    color: #fff;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #btnLoad:hover {
    background: #0066cc;
  }
  #inputContainer {
    display: flex;
    align-items: center;
  }
  #canvas-container {
    margin-top: 30px;
    width: 440px;
    height: 580px;
    border-radius: 16px;
    background: rgba(30,144,255,0.05);
    box-shadow: 0 0 30px rgba(30,144,255,0.1);
    backdrop-filter: blur(18px);
    overflow: hidden;
    position: relative;
  }
  #status {
    position: absolute;
    top: 12px;
    left: 16px;
    color: #1e90ffcc;
    font-weight: 600;
    text-shadow: 0 0 8px #1e90ff55;
    z-index: 10;
  }
  #animationControls {
    margin-top: 18px;
    display: flex;
    justify-content: center;
    gap: 12px;
  }
  .animBtn {
    background: rgba(30,144,255,0.15);
    color: #1e90ff;
    border-radius: 10px;
    padding: 10px 16px;
    cursor: pointer;
    user-select:none;
    font-weight: 600;
    font-size: 14px;
    transition: background 0.3s ease;
  }
  .animBtn:hover {
    background: rgba(30,144,255,0.3);
  }
</style>
</head>
<body>

<h1>Roblox Avatar 3D Clean - DK Edition</h1>
<div id="inputContainer">
  <input id="inputNick" type="text" placeholder="Cola o nick do player aqui" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" />
  <button id="btnLoad">Buscar Avatar</button>
</div>
<div id="canvas-container">
  <div id="status">Aguardando nick...</div>
</div>
<div id="animationControls" style="display:none;">
  <div class="animBtn" data-anim="idle">Idle</div>
  <div class="animBtn" data-anim="dance">Dançar</div>
  <div class="animBtn" data-anim="run">Correr</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>

<script>
  const container = document.getElementById('canvas-container')
  const status = document.getElementById('status')
  const animControls = document.getElementById('animationControls')
  const animButtons = [...document.querySelectorAll('.animBtn')]

  let scene, camera, renderer, mixer, clock, avatarModel, currentAction

  clock = new THREE.Clock()

  function initScene() {
    scene = new THREE.Scene()
    scene.background = new THREE.Color(0x000000)
    camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000)
    camera.position.set(0, 1.7, 3.5)

    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true })
    renderer.setSize(container.clientWidth, container.clientHeight)
    container.appendChild(renderer.domElement)

    const light = new THREE.DirectionalLight(0xffffff, 1)
    light.position.set(0, 10, 10)
    scene.add(light)

    const ambient = new THREE.AmbientLight(0x404040, 2)
    scene.add(ambient)

    // chão simples
    const floorGeo = new THREE.PlaneGeometry(10, 10)
    const floorMat = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 1 })
    const floor = new THREE.Mesh(floorGeo, floorMat)
    floor.rotation.x = -Math.PI / 2
    floor.position.y = 0
    scene.add(floor)
  }

  function animate() {
    requestAnimationFrame(animate)
    if(mixer) mixer.update(clock.getDelta())
    renderer.render(scene, camera)
  }

  // Função confiável pra pegar UserId pela API oficial da Roblox
  async function getUserId(nick) {
    try {
      const res = await fetch(`https://users.roblox.com/v1/usernames/users`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({usernames: [nick]})
      })
      const data = await res.json()
      if(data && data.data && data.data.length > 0) {
        return data.data[0].id
      }
    } catch(e) {
      console.warn('Erro ao buscar UserId:', e)
    }
    return null
  }

  // Carrega o modelo 3D do avatar (demo genérico por limitação)
  async function loadAvatarModel(userId) {
    if(avatarModel){
      scene.remove(avatarModel)
      mixer = null
      avatarModel = null
    }

    status.textContent = "Carregando avatar 3D..."

    // Modelo demo com animação idle
    const loader = new THREE.GLTFLoader()
    const demoModels = {
      idle: "https://models.babylonjs.com/Dude/dude.gltf",
      dance: "https://models.babylonjs.com/Soldier/Soldier.gltf",
      run: "https://models.babylonjs.com/Warrior/Warrior.gltf"
    }

    await new Promise((resolve, reject) => {
      loader.load(demoModels.idle, gltf => {
        avatarModel = gltf.scene
        avatarModel.scale.set(0.02, 0.02, 0.02)
        scene.add(avatarModel)

        mixer = new THREE.AnimationMixer(avatarModel)
        currentAction = mixer.clipAction(gltf.animations[0])
        currentAction.play()

        resolve()
      }, undefined, e => reject(e))
    })

    status.textContent = "Avatar carregado! (demo genérico)"
    animControls.style.display = "flex"
  }

  // Trocar animação demo
  function changeAnimation(name){
    if(!mixer || !avatarModel) return
    if(currentAction) currentAction.stop()

    const loader = new THREE.GLTFLoader()
    const demoModels = {
      idle: "https://models.babylonjs.com/Dude/dude.gltf",
      dance: "https://models.babylonjs.com/Soldier/Soldier.gltf",
      run: "https://models.babylonjs.com/Warrior/Warrior.gltf"
    }

    loader.load(demoModels[name], gltf => {
      scene.remove(avatarModel)
      avatarModel = gltf.scene
      avatarModel.scale.set(0.02, 0.02, 0.02)
      scene.add(avatarModel)
      mixer = new THREE.AnimationMixer(avatarModel)
      currentAction = mixer.clipAction(gltf.animations[0])
      currentAction.play()
    })
  }

  document.getElementById("btnLoad").onclick = async () => {
    const nick = document.getElementById("inputNick").value.trim()
    if(!nick){
      alert("Cola o nick aí, irmão!")
      return
    }
    status.textContent = "Buscando UserId..."
    const userId = await getUserId(nick)
    if(!userId){
      status.textContent = "Nick não encontrado, tenta outro aí"
      return
    }
    status.textContent = `UserId encontrado: ${userId}`
    await loadAvatarModel(userId)
  }

  animButtons.forEach(btn => {
    btn.onclick = () => changeAnimation(btn.dataset.anim)
  })

  initScene()
  animate()
</script>

</body>
</html>
